"""
质量评估与检查清单

用于评估生成视频的质量标准和检查项目
"""

# 质量评估标准

## 1. 插入点质量

### 评分标准（1-5分）

**5分 - 优秀**
- 插入点在自然的话题转折处
- 前后文语义连贯
- 广告词与视频内容高度相关
- 过渡自然，观众几乎感觉不到中断

**4分 - 良好**
- 插入点位置合理
- 前后文基本连贯
- 广告词与内容相关
- 过渡较自然

**3分 - 及格**
- 插入点可以接受
- 前后文不太突兀
- 广告词能够融入
- 有轻微的不连贯感

**2分 - 待改进**
- 插入点不够理想
- 前后文有明显跳跃
- 广告词关联性弱
- 明显的中断感

**1分 - 不合格**
- 插入点选择错误（如在句子中间）
- 完全破坏内容连贯性
- 广告词与内容无关
- 严重的突兀感

### 检查项目

- [ ] 插入点是否避开了视频开头5秒和结尾5秒
- [ ] 插入点是否在句子结束处或自然停顿处
- [ ] 插入前的内容是否完整
- [ ] 插入后的内容是否能自然衔接
- [ ] LLM提供的上下文是否准确
- [ ] 插入理由是否合理

## 2. 广告词质量

### 评分标准（1-5分）

**5分 - 优秀**
- 完美融入视频语境
- 保持原视频的语气和风格
- 产品卖点表达清晰
- 长度适中（15-30字）
- 语言自然流畅

**4分 - 良好**
- 较好融入视频
- 语气基本一致
- 卖点明确
- 长度合适

**3分 - 及格**
- 基本融入
- 语气可接受
- 包含产品信息
- 长度尚可

**2分 - 待改进**
- 融入度不够
- 语气不匹配
- 卖点表达不清
- 过长或过短

**1分 - 不合格**
- 完全不融入
- 生硬的广告文案
- 无产品信息或信息错误
- 长度严重不合适

### 检查项目

- [ ] 广告词长度是否在15-30字之间
- [ ] 是否使用了配置的产品卖点
- [ ] 语气是否与原视频一致（正式/轻松/幽默等）
- [ ] 是否包含生硬的广告用语
- [ ] 是否有语法错误或不通顺
- [ ] 是否自然提及产品名称

## 3. 数字人视频质量

### 评分标准（1-5分）

**5分 - 优秀**
- 口型完美同步
- 表情自然
- 画面清晰
- 无明显瑕疵
- 人物形象真实

**4分 - 良好**
- 口型基本同步
- 表情较自然
- 画面质量好
- 瑕疵极少

**3分 - 及格**
- 口型可接受
- 表情尚可
- 画面清晰度一般
- 有轻微瑕疵

**2分 - 待改进**
- 口型有明显不同步
- 表情僵硬
- 画面模糊
- 瑕疵较多

**1分 - 不合格**
- 口型完全不同步
- 表情失真
- 画面质量差
- 严重瑕疵

### 检查项目

**图片清洗**
- [ ] 文字是否已清除
- [ ] 水印是否已去除
- [ ] 人物面部是否清晰
- [ ] 背景是否自然
- [ ] 是否有过度处理的痕迹

**声音克隆**
- [ ] 声音是否与原视频人物相似
- [ ] 音色是否自然
- [ ] 语速是否适中
- [ ] 发音是否清晰
- [ ] 是否有杂音或失真

**数字人生成**
- [ ] 口型与声音是否同步
- [ ] 面部表情是否自然
- [ ] 头部动作是否流畅
- [ ] 眼神是否真实
- [ ] 整体协调性

## 4. 最终视频质量

### 评分标准（1-5分）

**5分 - 优秀**
- 视频拼接无缝衔接
- 音频过渡平滑
- 画质一致
- 观看体验流畅

**4分 - 良好**
- 拼接基本无缝
- 音频过渡自然
- 画质基本一致

**3分 - 及格**
- 拼接可见但可接受
- 音频有轻微跳跃
- 画质有差异但不明显

**2分 - 待改进**
- 拼接痕迹明显
- 音频跳跃明显
- 画质差异较大

**1分 - 不合格**
- 拼接失败或严重不自然
- 音频断裂
- 画质严重不一致

### 检查项目

**视频拼接**
- [ ] 插入点前后画面是否流畅
- [ ] 是否有黑屏或闪烁
- [ ] 视频分辨率是否一致
- [ ] 帧率是否一致
- [ ] 长宽比是否一致

**音频质量**
- [ ] 音频是否连续
- [ ] 音量是否一致
- [ ] 是否有爆音或杂音
- [ ] 背景音乐是否被意外去除
- [ ] 整体音频清晰度

**整体观感**
- [ ] 完整观看是否流畅
- [ ] 广告插入是否自然
- [ ] 是否达到预期效果
- [ ] 是否有技术性错误
- [ ] 观众体验是否良好

## 5. 技术指标

### 必须满足的技术要求

**视频参数**
- [ ] 输出格式为MP4
- [ ] 视频编码为H.264
- [ ] 音频编码为AAC
- [ ] 分辨率不低于原视频
- [ ] 帧率与原视频一致

**文件质量**
- [ ] 文件大小合理（不超过原视频2倍）
- [ ] 文件可正常播放
- [ ] 兼容主流播放器
- [ ] 元数据完整

**处理质量**
- [ ] 所有5个阶段成功完成
- [ ] 无异常或错误
- [ ] 临时文件已清理
- [ ] 日志信息完整

## 综合评分

### 计算方法
总分 = (插入点质量 × 0.25) + (广告词质量 × 0.25) + (数字人质量 × 0.3) + (最终视频质量 × 0.2)

### 等级划分
- **A级（4.5-5.0分）**: 优秀，可直接使用
- **B级（3.5-4.4分）**: 良好，建议使用
- **C级（2.5-3.4分）**: 及格，可用但建议优化
- **D级（1.5-2.4分）**: 待改进，不建议使用
- **E级（<1.5分）**: 不合格，需要重新处理

## 质量改进建议

### 如果插入点质量不佳
1. 调整LLM提示词，强调话题转折
2. 增加候选插入点数量（从3个增加到5个）
3. 检查ASR识别准确度
4. 手动指定插入时间点

### 如果广告词质量不佳
1. 优化广告配置文件（卖点、模板）
2. 调整LLM提示词，强调自然融入
3. 提供更详细的产品信息
4. 手动编写广告词

### 如果数字人质量不佳
1. 提高关键帧质量（选择更清晰的人脸）
2. 改进人声分离效果
3. 调整ComfyUI workflow参数
4. 尝试不同的声音情绪设置

### 如果视频拼接质量不佳
1. 检查原视频和广告视频的参数是否一致
2. 调整视频编码参数
3. 使用更高质量的编码预设
4. 检查是否有音视频同步问题

## 测试用例

### 标准测试视频要求
为了全面测试系统，建议准备以下类型的测试视频：

1. **科技类视频**（30-60秒）
   - 有清晰的主持人出镜
   - 讲解科技知识或产品
   - 语速适中

2. **教育类视频**（30-60秒）
   - 教学内容
   - 有明显的段落结构
   - 正式语气

3. **生活类视频**（30-60秒）
   - 轻松的vlog风格
   - 随性的口语表达
   - 可能有背景音乐

4. **营销类视频**（30-60秒）
   - 产品介绍
   - 已包含一些广告元素
   - 测试广告融入度

### 预期结果
- 科技类视频：通常能达到A-B级
- 教育类视频：通常能达到A-B级
- 生活类视频：通常能达到B-C级
- 营销类视频：通常能达到C-D级（因为已有广告元素可能冲突）

## 质量报告模板

```
视频质量评估报告

视频ID: __________
处理时间: __________

1. 插入点质量
   评分: __ / 5
   备注: ____________________

2. 广告词质量
   评分: __ / 5
   广告词: ____________________
   备注: ____________________

3. 数字人质量
   评分: __ / 5
   - 图片清洗: __ / 5
   - 声音克隆: __ / 5
   - 数字人生成: __ / 5
   备注: ____________________

4. 最终视频质量
   评分: __ / 5
   备注: ____________________

综合评分: __ / 5
等级: __
建议: ____________________
```
